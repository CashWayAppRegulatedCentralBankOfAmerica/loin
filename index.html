<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WorkHub | Login & Signup</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      emailjs.init("0ockMZ07aVnggqzsD");  // Initialize EmailJS with your public key
    });

    const approvedUsers = {
      "jackfayama@gmail.com": "123",
      "yvonneakinyiouma@gmail.co": "1234",
      "alice@gmail.com": "alice123",
      "brian@gmail.com": "brian123",
      "carol@gmail.com": "carol123",
      "daniel@gmail.com": "dan123",
      "eliza@gmail.com": "eliza123"
    };

    // Add new user dynamically
    function addNewUser(email, password) {
      approvedUsers[email] = password;
      localStorage.setItem('approvedUsers', JSON.stringify(approvedUsers));
    }

    // Load stored approved users
    if (localStorage.getItem('approvedUsers')) {
      Object.assign(approvedUsers, JSON.parse(localStorage.getItem('approvedUsers')));
    }

    function toggleForm() {
      document.getElementById('login-form').classList.toggle('hidden');
      document.getElementById('signup-form').classList.toggle('hidden');
      document.getElementById('modal').classList.add('hidden');
    }

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();

      if (approvedUsers[email] === password) {
        alert("Login successful! Redirecting...");
        window.location.href = '/dashboard';  // Redirect to dashboard (or any desired page)
      } else {
        showModal("Login failed. Please check your credentials.");
      }
    }

    function handleSignup(event) {
      event.preventDefault();
      const name = document.getElementById('signup-name').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value.trim();

      if (approvedUsers[email]) {
        showModal("This email is already registered. Please use a different one.");
        return;
      }

      const templateParams = {
        name,
        email,
        password
      };

      emailjs.send("service_g5v9kbm", "template_eelornk", templateParams)
        .then(() => {
          // Dynamically add the new user to the approved users list
          addNewUser(email, password);

          // Show success modal and redirect to login page
          showModal("Registration successful! Please wait for approval.");
        })
        .catch(() => {
          showModal("Error submitting registration. Please try again.");
        });
    }

    function showModal(message) {
      const modal = document.getElementById('modal');
      document.getElementById('modal-message').innerText = message;
      modal.classList.remove('hidden');
    }

    function redirectToLogin() {
      document.getElementById('modal').classList.add('hidden');
      toggleForm();  // Switch to login form
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center">
  <div class="container mx-auto px-4 py-12 max-w-md">
    <!-- Login Form -->
    <div id="login-form" class="bg-white p-8 shadow-md rounded-lg">
      <h2 class="text-2xl font-bold text-green-600 mb-4">Login to WorkHub</h2>
      <form class="space-y-4" onsubmit="handleLogin(event)">
        <div>
          <label class="block text-sm font-medium">Email</label>
          <input id="login-email" type="email" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Enter your email" required>
        </div>
        <div>
          <label class="block text-sm font-medium">Password</label>
          <input id="login-password" type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">Login</button>
      </form>
      <p class="text-sm mt-4 text-center">Don't have an account? <button onclick="toggleForm()" class="text-green-600 hover:underline">Sign up</button></p>
    </div>

    <!-- Signup Form -->
    <div id="signup-form" class="bg-white p-8 shadow-md rounded-lg hidden">
      <h2 class="text-2xl font-bold text-green-600 mb-4">Create a WorkHub Account</h2>
      <form class="space-y-4" onsubmit="handleSignup(event)">
        <div>
          <label class="block text-sm font-medium">Full Name</label>
          <input id="signup-name" type="text" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Your full name" required>
        </div>
        <div>
          <label class="block text-sm font-medium">Email</label>
          <input id="signup-email" type="email" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Your email" required>
        </div>
        <div>
          <label class="block text-sm font-medium">Password</label>
          <input id="signup-password" type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Choose a password" required>
        </div>
        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">Sign Up</button>
      </form>
      <p class="text-sm mt-4 text-center">Already have an account? <button onclick="toggleForm()" class="text-green-600 hover:underline">Sign in</button></p>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 shadow-lg max-w-sm text-center">
        <p id="modal-message" class="text-gray-800 mb-4"></p>
        <button onclick="redirectToLogin()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">OK</button>
      </div>
    </div>
  </div>
</body>
</html>
