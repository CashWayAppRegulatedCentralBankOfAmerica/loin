<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WorkHub | Login & Signup</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      emailjs.init("0ockMZ07aVnggqzsD");
    });

    const approvedUsers = {
      "jackfayama@gmail.com": "123",
      "yvonneakinyiouma@gmail.co": "1234",
      "alice@gmail.com": "alice123",
      "brian@gmail.com": "brian123",
      "carol@gmail.com": "carol123",
      "daniel@gmail.com": "dan123",
      "eliza@gmail.com": "eliza123"
    };

    const suspendedUsers = ["jackrealkenya@gmail.com.com", "suspended1@example.com", "suspended2@example.com", "suspended3@example.com"];
    const registeredUsers = { ...approvedUsers };

    function toggleForm() {
      document.getElementById('login-form').classList.toggle('hidden');
      document.getElementById('signup-form').classList.toggle('hidden');
      document.getElementById('modal').classList.add('hidden');
    }

    function showModal(message, redirectToLogin = false) {
      const modal = document.getElementById('modal');
      document.getElementById('modal-message').innerText = message;
      modal.classList.remove('hidden');
      if (redirectToLogin) {
        document.getElementById('modal-ok-btn').onclick = () => {
          modal.classList.add('hidden');
          document.getElementById('signup-form').classList.add('hidden');
          document.getElementById('login-form').classList.remove('hidden');
        };
      } else {
        document.getElementById('modal-ok-btn').onclick = () => modal.classList.add('hidden');
      }
    }

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();

      if (suspendedUsers.includes(email)) {
        showModal("Your account has been suspended. Please contact support.");
        return;
      }

      if (registeredUsers[email] === password) {
        showModal("Login successful! Redirecting...");
        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 1500);
      } else {
        showModal("Login failed. Please check your credentials.");
      }
    }

    function handleSignup(event) {
      event.preventDefault();
      const name = document.getElementById('signup-name').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value.trim();
      const confirm = document.getElementById('signup-confirm-password').value.trim();
      const phone = document.getElementById('signup-phone').value.trim();
      const code = document.getElementById('signup-code').value;
      const nationality = document.getElementById('signup-nationality').value;
      const county = document.getElementById('signup-county').value.trim();
      const postal = document.getElementById('signup-postal').value.trim();
      const gender = document.getElementById('signup-gender').value;
      const agree = document.getElementById('signup-terms').checked;

      if (!agree) {
        showModal("You must agree to the terms and conditions.");
        return;
      }

      if (password !== confirm) {
        showModal("Passwords do not match.");
        return;
      }

      if (registeredUsers[email]) {
        showModal("This email is already registered.");
        return;
      }

      registeredUsers[email] = password;

      const templateParams = {
        name,
        email,
        password,
        phone: `${code} ${phone}`,
        nationality,
        county,
        postal,
        gender
      };

      emailjs.send("service_g5v9kbm", "template_eelornk", templateParams)
        .then(() => {
          showModal("Registration successful! Please wait for approval.", true);
        })
        .catch(() => {
          showModal("Error submitting registration. Please try again.");
        });
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center">
  <div class="container mx-auto px-4 py-12 max-w-md">
    <!-- Login Form -->
    <div id="login-form" class="bg-white p-8 shadow-md rounded-lg">
      <h2 class="text-2xl font-bold text-green-600 mb-4">Login to WorkHub</h2>
      <form class="space-y-4" onsubmit="handleLogin(event)">
        <div>
          <label class="block text-sm font-medium">Email</label>
          <input id="login-email" type="email" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
        </div>
        <div>
          <label class="block text-sm font-medium">Password</label>
          <input id="login-password" type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
        </div>
        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">Login</button>
      </form>
      <p class="text-sm mt-4 text-center">Don't have an account? <button onclick="toggleForm()" class="text-green-600 hover:underline">Sign up</button></p>
    </div>

    <!-- Signup Form -->
    <div id="signup-form" class="bg-white p-8 shadow-md rounded-lg hidden">
      <h2 class="text-2xl font-bold text-green-600 mb-4">Create a WorkHub Account</h2>
      <form class="space-y-4" onsubmit="handleSignup(event)">
        <div><label class="block text-sm font-medium">Full Name</label><input id="signup-name" type="text" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required></div>
        <div><label class="block text-sm font-medium">Email</label><input id="signup-email" type="email" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required></div>
        <div><label class="block text-sm font-medium">Password</label><input id="signup-password" type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required></div>
        <div><label class="block text-sm font-medium">Confirm Password</label><input id="signup-confirm-password" type="password" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500" required></div>
        <div><label class="block text-sm font-medium">Mobile Number</label><div class="flex space-x-2"><select id="signup-code" class="w-1/3 px-2 py-2 border rounded"><option value="+254">+254</option><option value="+1">+1</option><option value="+44">+44</option><option value="+91">+91</option></select><input id="signup-phone" type="text" class="w-2/3 px-4 py-2 border rounded" required></div></div>
        <div><label class="block text-sm font-medium">Nationality</label><select id="signup-nationality" class="w-full px-4 py-2 border rounded"><option value="Kenyan">Kenyan</option><option value="Nigerian">Nigerian</option><option value="American">American</option><option value="British">British</option></select></div>
        <div><label class="block text-sm font-medium">County</label><input id="signup-county" type="text" class="w-full px-4 py-2 border rounded" required></div>
        <div><label class="block text-sm font-medium">Postal Address</label><input id="signup-postal" type="text" class="w-full px-4 py-2 border rounded" required></div>
        <div><label class="block text-sm font-medium">Sex</label><select id="signup-gender" class="w-full px-4 py-2 border rounded"><option value="Male">Male</option><option value="Female">Female</option></select></div>
        <div><label class="inline-flex items-center"><input type="checkbox" id="signup-terms" class="form-checkbox text-green-600 mr-2" required><span class="text-sm">I agree to the terms and conditions</span></label></div>
        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">Sign Up</button>
      </form>
      <p class="text-sm mt-4 text-center">Already have an account? <button onclick="toggleForm()" class="text-green-600 hover:underline">Sign in</button></p>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 shadow-lg max-w-sm text-center">
        <p id="modal-message" class="text-gray-800 mb-4"></p>
        <button id="modal-ok-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">OK</button>
      </div>
    </div>
  </div>
</body>
</html>
