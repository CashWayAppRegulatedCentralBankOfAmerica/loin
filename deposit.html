<!-- Deposit trigger (could be a text or button) -->
<span id="depositTrigger" class="cursor-pointer text-green-600 font-semibold select-none">Deposit Funds</span>

<!-- Modal HTML (hidden by default) -->
<div id="depositModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); 
  display:flex; align-items:center; justify-content:center; z-index:1000;">
  <div style="background:#fff; padding:2rem; border-radius:0.5rem; max-width:400px; width:90%;">
    <h2 style="color:#15803d; font-weight:bold; margin-bottom:1rem;">Enter Deposit Details</h2>
    <label>Amount ($):</label>
    <input type="number" id="depositAmount" min="1" step="0.01" style="width:100%; padding:0.5rem; margin-bottom:1rem;" placeholder="Enter deposit amount" />
    <label>MPESA Transaction ID:</label>
    <input type="text" id="depositMpesaId" style="width:100%; padding:0.5rem; margin-bottom:1rem;" placeholder="Enter MPESA transaction ID" />
    <p id="depositError" style="color:red; font-weight:bold; display:none; margin-bottom:1rem;"></p>
    <div style="display:flex; gap:1rem;">
      <button id="depositCancel" style="flex:1; padding:0.75rem; background:#ddd; border:none; border-radius:0.25rem; font-weight:bold; cursor:pointer;">Cancel</button>
      <button id="depositConfirm" style="flex:1; padding:0.75rem; background:#15803d; border:none; border-radius:0.25rem; font-weight:bold; color:#fff; cursor:pointer;">Confirm</button>
    </div>
  </div>
</div>

<script>
  const depositTrigger = document.getElementById('depositTrigger');
  const depositModal = document.getElementById('depositModal');
  const depositCancel = document.getElementById('depositCancel');
  const depositConfirm = document.getElementById('depositConfirm');
  const depositError = document.getElementById('depositError');
  const depositAmount = document.getElementById('depositAmount');
  const depositMpesaId = document.getElementById('depositMpesaId');

  // Example valid MPESA IDs - replace with your real validation method
  const validMpesaIds = ['ABC123XYZ', 'MPESA789456', 'TXN20230515'];

  depositTrigger.addEventListener('click', () => {
    depositError.style.display = 'none';
    depositAmount.value = '';
    depositMpesaId.value = '';
    depositModal.style.display = 'flex';
    depositAmount.focus();
  });

  depositCancel.addEventListener('click', () => {
    depositModal.style.display = 'none';
  });

  depositConfirm.addEventListener('click', () => {
    const amount = parseFloat(depositAmount.value);
    const mpesaId = depositMpesaId.value.trim();

    if (!amount || amount <= 0) {
      depositError.textContent = 'Please enter a valid deposit amount.';
      depositError.style.display = 'block';
      return;
    }
    if (!mpesaId) {
      depositError.textContent = 'Please enter the MPESA transaction ID.';
      depositError.style.display = 'block';
      return;
    }
    if (!validMpesaIds.includes(mpesaId)) {
      depositError.textContent = 'Invalid MPESA transaction ID. Please check and try again.';
      depositError.style.display = 'block';
      return;
    }

    // Update balances in localStorage (both Total and Available)
    let totalBalance = parseFloat(localStorage.getItem('totalBalance') || '0');
    let availableBalance = parseFloat(localStorage.getItem('availableBalance') || '0');

    totalBalance += amount;
    availableBalance += amount;

    localStorage.setItem('totalBalance', totalBalance.toFixed(2));
    localStorage.setItem('availableBalance', availableBalance.toFixed(2));

    // Add transaction (deposit) to recent transactions in localStorage
    let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    transactions.push({
      type: 'Deposit',
      amount: amount.toFixed(2),
      mpesaId: mpesaId,
      date: new Date().toLocaleDateString(),
      time: new Date().toLocaleTimeString()
    });
    localStorage.setItem('transactions', JSON.stringify(transactions));

    // Set flag for showing success on account page
    localStorage.setItem('depositSuccess', `Deposit of $${amount.toFixed(2)} successful!`);

    // Close modal and redirect to account.html
    depositModal.style.display = 'none';
    window.location.href = 'account.html';
  });

  // Optional: Close modal if clicking outside modal content
  depositModal.addEventListener('click', e => {
    if (e.target === depositModal) {
      depositModal.style.display = 'none';
    }
  });
</script>
