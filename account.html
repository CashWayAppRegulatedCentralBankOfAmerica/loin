<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projects - WorkHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen p-4">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow">
    <h2 class="text-2xl font-bold mb-4 text-green-600">Submitted Bids</h2>
    <ul id="bidList" class="space-y-4">
      <!-- Tasks will be listed here -->
    </ul>
  </div>

  <script>
    const bidList = document.getElementById("bidList");
    const bidTransactions = JSON.parse(localStorage.getItem("transactions") || "[]").filter(t => t.type === "Bid");

    // Load paidTasks from localStorage
    const paidTasks = JSON.parse(localStorage.getItem("paidTasks") || "[]");

    function markAsPaid(taskId) {
      const input = prompt("Enter Verification Code:");
      if (input === "1234") {
        const txIndex = bidTransactions.findIndex(t => t.id === taskId);
        if (txIndex !== -1) {
          const paidTask = {
            id: bidTransactions[txIndex].id,
            amount: bidTransactions[txIndex].amount,
            date: bidTransactions[txIndex].date,
            time: bidTransactions[txIndex].time
          };
          // Save to paidTasks
          paidTasks.push(paidTask);
          localStorage.setItem("paidTasks", JSON.stringify(paidTasks));

          // Update balance
          let balance = parseFloat(localStorage.getItem("balance") || "0");
          balance += parseFloat(paidTask.amount);
          localStorage.setItem("balance", balance.toFixed(2));

          // Play notification sound
          const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3");
          audio.play();

          alert("Payment verified successfully.");
          window.location.reload();
        }
      } else {
        alert("Invalid code. Payment not verified.");
      }
    }

    if (bidTransactions.length === 0) {
      bidList.innerHTML = "<li class='text-gray-500 text-sm'>No bids submitted yet.</li>";
    } else {
      bidTransactions.forEach(tx => {
        const isPaid = paidTasks.some(t => t.id === tx.id);
        const li = document.createElement("li");
        li.className = "bg-gray-50 border-l-4 border-gray-300 p-4 rounded shadow flex justify-between items-center";
        li.innerHTML = `
          <div>
            <p class="text-gray-800 font-semibold">Task ID: ${tx.id}</p>
            <p class="text-sm text-gray-500">Amount: $${parseFloat(tx.amount).toFixed(2)} | Date: ${tx.date}</p>
            <p class="text-xs mt-1">${isPaid ? '<span class="text-green-600 font-bold">Paid</span>' : '<span class="text-yellow-500">Pending Verification</span>'}</p>
          </div>
          ${!isPaid ? `<button onclick="markAsPaid('${tx.id}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Verify</button>` : ''}
        `;
        bidList.appendChild(li);
      });
    }
  </script>
</body>
</html>
